module Test.BN254 where

import Protolude

import Data.Curve.Weierstrass
import Data.Field.Galois
import Data.Pairing.BN254
import Test.Tasty
import Test.Tasty.HUnit
import Test.Tasty.QuickCheck

import Test.Pairing

testBN254 :: TestTree
testBN254 = localOption (QuickCheckTests 10) $ testGroup "BN254"
  [ groupPairingAxioms (witness :: BN254)
  , curvePairingAxioms (witness :: BN254)
  , testGroup "Temporary"
    [ testCase "verify Miller's algorithm" $
      atePairing g1 g2 @?= ma
    , testCase "verify final exponentiation" $
      reducedPairing g1 g2 @?= fe
    , testProperty "test Frobenius endomorphism" $
      (==) <$> frobeniusNaive 1 <*> fq12Frobenius 1
    , testProperty "test final exponentiation" $
      (==) <$> finalExponentiation <*> finalExponentiationNaive
    ]
  ]

g1 :: G1 BN254
g1 = A
  1368015179489954701390400359078579693043519447331113978918064868415326638035
  9918110051302171585080402603319702774565515993150576347155970296011118125764

g2 :: G2 BN254
g2 = A
  ( toE' [ 2725019753478801796453339367788033689375851816420509565303521482350756874229
         , 7273165102799931111715871471550377909735733521218303035754523677688038059653
         ]
  )
  ( toE' [ 2512659008974376214222774206987427162027254181373325676825515531566330959255
         , 957874124722006818841961785324909313781880061366718538693995380805373202866
         ]
  )

ma :: GT BN254
ma = toU' $
  toE' [ toE' [ toE' [ 10244919957345566208036224388367387294947954375520342002142038721148536068658
                     , 20520725903107462730350108147804326707908059028221039276493719519842949720531
                     ]
              , toE' [ 6086095302240468555411758663466251351417777262748587710512082696159022563215
                     , 3498483043828007000664704983384438380014626741459095899124517210966193962189
                     ]
              , toE' [ 9839947403899670326057934148290729066991318244952536153418081752510541932805
                     , 9202072764973620760720243946210007480782851719144203914690329192926361472509
                     ]
              ]
       , toE' [ toE' [ 10396963991176748371570893144856868074352236348257264320828640725417622807401
                     , 16918234646064442383576265933863121396979541666923405352165222603555475148795
                     ]
              , toE' [ 1146287855099517708899800840204495527878843746533321795244252048321172986641
                     , 15272723827732170058231690870045992172379497733734277515700990114389642596090
                     ]
              , toE' [ 6026541190208646112995382377707652888403252171847993766999540977939986078453
                     , 4033750506662808934164561353819561401109395743946249795674228367029912558059
                     ]
              ]
       ]

fe :: GT BN254
fe = toU $
  toE' [ toE' [ toE' [ 7297928317524675251652102644847406639091474940444702627333408876432772026640
                     , 18010865284024443253481973710158529446817119443459787454101328040744995455319
                     ]
              , toE' [ 14179125828660221708486990054318233868908974550229474018509093903907472063156
                     , 19672547343219696395323430329000470270122259521813831378125910505067755316037
                     ]
              , toE' [ 10811020225621941034352015694422164943041584464746963243431262955968538467312
                     , 18591344525433923700278298641693487837785792806011751060570085671866249379154
                     ]
              ]
       , toE' [ toE' [ 18214296718386486500838507024306049626571830525675768493345345883297201451077
                     , 19227311731387426597265504864999881769743583647552324796732605660514141916117
                     ]
              , toE' [ 15463354980731838106439887363063618463783317416732018231077874458188347926701
                     , 3765441250413579779915094051038487360437654739171671492016287185303087270469
                     ]
              , toE' [ 21029416079740174485345021549306749850075185576152640151652655104272393297142
                     , 19736982780723093346009254617143639137054958583796054069884522103959451721163
                     ]
              ]
       ]
